"use strict";function OmBox(e,t){if(typeof e==="object"){this.window=e}else{this.window=document.getElementById(e)}if(typeof t==="undefined"){t=OMBOX_DEFAULT}this.parseCustomize(t);if(this.overlay){this.overlayCreate()}var n=document.getElementsByTagName("script");for(var r=0;r<n.length;r++){var i=n[r].src.split("OmBox.js");if(i.length===2){this.serverLocation=i[0]}}this.init()}function touchHandler(e){var t=e.changedTouches[0];var n=document.createEvent("MouseEvent");n.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],true,true,window,1,t.screenX,t.screenY,t.clientX,t.clientY,false,false,false,false,0,null);t.target.dispatchEvent(n);e.preventDefault()}function touchDefault(e){e.addEventListener("touchstart",touchHandler,true);e.addEventListener("touchmove",touchHandler,true);e.addEventListener("touchend",touchHandler,true);e.addEventListener("touchcancel",touchHandler,true)}function clickDefault(e){e.ontouchstart=e.onclick;e.ontouchmove=function(){return true};e.ontouchend=function(){return true};e.ontouchcancel=function(){return true}}function getMouseXY(e){var t={};if(!isset(e)){t["x"]=event.clientX+document.body.scrollLeft;t["y"]=event.clientY+document.body.scrollTop}else{t["x"]=e.pageX;t["y"]=e.pageY}if(t["x"]<0){t["x"]=0}if(t["y"]<0){t["y"]=0}return t}function isset(e){if(typeof e=="undefined"){return false}else{return true}}function in_array(e,t,n){var r="",i=!!n;if(i){for(r in t){if(t[r]===e){return true}}}else{for(r in t){if(t[r]==e){return true}}}return false}var OmBoxThemes=[];var OmBoxes=[];var OMBOX_DEFAULT={theme:"OmDefault",title:"",resizeable:true,classOn:"OmBoxSlideOn",classOff:"OmBoxSlideOff",deleteButton:true,fullSizeButton:true,outButton:true,footer:true,top:20,overlay:false,showDefault:false};OmBox.prototype={init:function(){if(OmBoxes.length<1){this.loadTheme("OmBoxCore")}this.contentInit();this.headerCreate();if(this.footer){this.footerCreate()}this.buttonEnable();this.setTheme(this.theme);this.clear();OmBoxes.push(this);var e="ontouchstart"in window;if(e){this.mobileSetup()}var t=this;if(this.showDefault){setTimeout(function(){t.show()},600)}return this},contentInit:function(){this.contents=this.window.getElementsByTagName("div");if(!this.contents[0]){this.contents=document.createElement("div");this.window.appendChild(this.contents)}else{this.contents=this.contents[0]}},headerCreate:function(){this.boxTop=document.createElement("div");this.controlsWrap=document.createElement("span");this.moveAbleWrap=document.createElement("a");this.moveAbleWrap.href="javascript:void(0)";this.titleElement=document.createElement("h3");this.titleElement.innerHTML=this.title;if(this.deleteButton){this.deleteButton=document.createElement("a");this.deleteButton.href="javascript:void(0)";this.controlsWrap.appendChild(this.deleteButton)}if(this.fullSizeButton){this.fullSizeButton=document.createElement("a");this.fullSizeButton.href="javascript:void(0)";this.controlsWrap.appendChild(this.fullSizeButton)}if(this.outButton){this.outButton=document.createElement("a");this.outButton.href="javascript:void(0)";this.controlsWrap.appendChild(this.outButton)}this.boxTop.appendChild(this.controlsWrap);this.moveAbleWrap.appendChild(this.titleElement);this.boxTop.appendChild(this.moveAbleWrap);this.window.insertBefore(this.boxTop,this.window.firstChild)},footerCreate:function(){this.footer=document.createElement("div");this.footer.className=this.theme+"Footer";this.resizeHandle=document.createElement("a");this.resizeHandle.href="javascript:void(0)";this.resizeHandle.className=this.theme+"Handle";this.footer.appendChild(this.resizeHandle);this.window.appendChild(this.footer)},buttonEnable:function(){var e=this;this.moveable(this.boxTop);if(this.deleteButton){this.deleteButton.onclick=function(){e.close()}}if(this.fullSizeButton){this.fullSizeButton.onclick=function(){e.fullSize()}}if(this.outButton){this.outButton.onclick=function(){e.moveOut()}}if(this.resizeHandle){this.resize(this.resizeHandle)}this.window.onclick=function(){e.zTop()}},show:function(){this.window.style.display="block";this.zTop();if(this.overlay){this.overlay.style.display="block"}var e=this;setTimeout(function(){if(!isset(this.window.classList)){e.window.className=e.theme+" "+e.classOn;return true}e.window.classList.remove(e.classOff);e.window.classList.add(e.classOn)},100);var t=document.documentElement;var n=(window.pageYOffset||t.scrollTop)-(t.clientTop||0);this.window.style.top=n+this.top+"px"},close:function(){if(!isset(this.window.classList)){this.window.className=this.theme+" "+this.classOff}else{this.window.classList.remove(this.classOn);this.window.classList.add(this.classOff)}var e=this;if(this.overlay){e.overlay.style.display="none"}setTimeout(function(){e.window.style.display="none"},1e3)},refresh:function(e){var t=this;this.close();setTimeout(function(){t.show()},parseInt(e))},clear:function(){this.window.style.display="none";if(!isset(this.window.classList)){this.window.className=this.theme+" "+this.classOff;return true}this.window.classList.remove(this.classOn);this.window.classList.add(this.classOff)},zTop:function(){var e=0;for(var t=0;t<OmBoxes.length;t++){if(e===0){e=OmBoxes[t].window.style.zIndex||5}if(parseInt(OmBoxes[t].window.style.zIndex)>e){e=OmBoxes[t].window.style.zIndex}}if(this.overlay){this.overlay.style.zIndex=++e}this.window.style.zIndex=++e},overlayCreate:function(){this.overlay=document.createElement("div");this.overlay.className="OmBoxOverlay";this.overlay.display="none";document.body.appendChild(this.overlay)},fullSize:function(){if(this.window.style.width=="100%"){this.window.style.top="10px";this.window.style.width="95%";this.window.style.height="80%"}else{this.window.style.top="0";this.window.style.left="0";this.window.style.width="100%";this.window.style.height="100%"}},moveOut:function(){var e=window.open("","mywindow","width=600,height=600");var t=this.window.innerHTML;e.document.body.innerHTML=t},moveable:function(e){var t=this;e.onmousedown=function(n){this.mouseDown++;t.move(n);if(isset(n)){n.preventDefault()}document.body.onclick=function(){t.stopMove(e)}};window.onmouseup=function(n){t.stopMove(e)}},move:function(e){this.zTop();var t=this;var n=getMouseXY(e);var r=n["x"];var i=n["y"];document.body.onmousemove=function(e){var n=getMouseXY(e);var s=r-n["x"];var o=t.window.style.left.split("px")[0]-s*1.2;var u=i-n["y"];var a=t.window.style.top.split("px")[0]-u*1;t.window.style.left=o+"px";t.window.style.top=a+"px";r=n["x"];i=n["y"]}},stopMove:function(e){e.onmousedown=null;document.body.onmousemove=null;document.body.onclick=null;this.moveable(e)},resize:function(e){this.resizeEl=e;var t=this;this.resizeEl.onmousedown=function(e){t.resizeMouseWatch(e);if(isset(e)){e.preventDefault()}window.onmouseup=function(){t.stopResize(t.resizeEl)};document.body.onclick=function(){t.stopResize(t.resizeEl)}}},resizeMouseWatch:function(e){var t=this;var n=getMouseXY(e);var r=t.window.offsetWidth;var i=t.window.offsetHeight-45;var s=t.window.offsetTop;var o=n["x"];var u=n["y"];document.body.onmousemove=function(e){var n=getMouseXY(e);var s=(o-n["x"])*2;var a=r-s;var f=u-n["y"];var l=i-f;t.window.style.width=a+"px";t.window.style.height=l+"px"}},stopResize:function(e){e.onmousedown=null;document.body.onmousemove=null;document.body.onclick=null;this.resize(e)}};OmBox.prototype.setData=function(e){if(!isset(e)){return false}if(typeof e==="object"){this.contents.innerHTML="";this.contents.appendChild(e);return true}else{this.contents.innerHTML=e}};OmBox.prototype.getData=function(){return this.contents.innerHTML};OmBox.prototype.setTheme=function(e){if(!isset(e)){console.log("Theme is empty");return false}if(!in_array(e,OmBoxThemes)){this.loadTheme(e)}this.theme=e;this.window.className=e;this.boxTop.className=e+"Top";if(this.deleteButton){this.deleteButton.className=e+"X"}if(this.fullSizeButton){this.fullSizeButton.className=e+"Full"}if(this.outButton){this.outButton.className=e+"Out"}if(this.footer){this.footer.className=e+"Footer"}if(this.contents){this.contents.className=e+"Content"}};OmBox.prototype.loadTheme=function(e){if(!in_array(e,this.themes)){var t=this.serverLocation+"_themes/"+e+".css";if(isset(t)){var n=document.createElement("link");n.href=t;n.rel="stylesheet";if(!isset(document.head)){document.body.insertBefore(n,document.body.firstChild)}else{document.head.appendChild(n)}}OmBoxThemes.push(e)}};OmBox.prototype.parseCustomize=function(e){var t=["theme","title","resizeable","classOn","classOff","deleteButton","fullSizeButton","outButton","footer","top","overlay","showDefault"];for(var n=0;n<t.length;n++){var r=t[n];if(!isset(e[t[n]])){this[r]=OMBOX_DEFAULT[r]}else{this[r]=e[r]}}return e};OmBox.prototype.mobileSetup=function(){touchDefault(this.boxTop);if(this.footer){touchDefault(this.footer)}if(this.deleteButton){clickDefault(this.deleteButton)}var e=this;if(this.deleteButton){this.deleteButton.ontouchstart=function(){e.close()}}if(this.fullSizeButton){this.fullSizeButton.ontouchstart=function(){e.fullSize()}}if(this.outButton){this.outButton.ontouchstart=function(){e.moveOut()}}}